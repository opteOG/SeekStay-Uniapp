import{o as e,c as t,w as a,d as r,t as s,D as i,f as l,a as n,z as o,g as d,n as u,m as c,i as f,q as h,r as m,u as p,B as y,E as _,G as g,y as D,A as b,C as k,j as v,k as w,F as M,H as S}from"./index-CXRbaKsi.js";import{_ as x}from"./uni-nav-bar.pIin5XDL.js";import{_ as L,r as j,a as C,o as I,b as T}from"./uni-app.es.4GHwWxH-.js";import{f as F}from"./formatPrice.BUD-VLoc.js";import{r as N}from"./index.TDGrnhG4.js";import{u as O}from"./userStore.Bb1cC01o.js";import"./uni-icons.CASMTA-H.js";function $(e,t=2){for(e+="";e.length<t;)e="0"+e;return e.slice(-t)}const R={yyyy:e=>$(e.year,4),yy:e=>$(e.year),MM:e=>$(e.month),M:e=>e.month,dd:e=>$(e.day),d:e=>e.day,hh:e=>$(e.hour),h:e=>e.hour,mm:e=>$(e.minute),m:e=>e.minute,ss:e=>$(e.second),s:e=>e.second,SSS:e=>$(e.millisecond,3),S:e=>e.millisecond};function z(e){return e instanceof Date?e:"string"==typeof e?e.indexOf("T")>-1?new Date(e):new Date(e.replace(/-/g,"/")):new Date(e)}function A(e,{locale:t="zh",threshold:a=[6e4,36e5],format:r="yyyy/MM/dd hh:mm:ss"}){if("-"===e)return e;if(!e&&0!==e)return"";const s={zh:{year:"年",month:"月",day:"天",hour:"小时",minute:"分钟",second:"秒",ago:"前",later:"后",justNow:"刚刚",soon:"马上",template:"{num}{unit}{suffix}"},en:{year:"year",month:"month",day:"day",hour:"hour",minute:"minute",second:"second",ago:"ago",later:"later",justNow:"just now",soon:"soon",template:"{num} {unit} {suffix}"}},i=s[t]||s.zh;let l,n,o=z(e),d=o.getTime()-Date.now(),u=Math.abs(d);if(u<a[0])return d<0?i.justNow:i.soon;if(u>=a[1])return function(e,t="yyyy/MM/dd hh:mm:ss"){if(!e&&0!==e)return"";const a={year:(e=z(e)).getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()},r=/yyyy|yy|MM|M|dd|d|hh|h|mm|m|ss|s|SSS|SS|S/;let s=!0,i=t;for(;s;)s=!1,i=i.replace(r,(function(e){return s=!0,R[e](a)}));return i}(o,r);let c=i.later;d<0&&(c=i.ago,d=-d);const f=Math.floor(d/1e3),h=Math.floor(f/60),m=Math.floor(h/60),p=Math.floor(m/24),y=Math.floor(p/30),_=Math.floor(y/12);switch(!0){case _>0:l=_,n=i.year;break;case y>0:l=y,n=i.month;break;case p>0:l=p,n=i.day;break;case m>0:l=m,n=i.hour;break;case h>0:l=h,n=i.minute;break;default:l=f,n=i.second}return"en"===t&&(1===l?l="a":n+="s"),i.template.replace(/{\s*num\s*}/g,l+"").replace(/{\s*unit\s*}/g,n).replace(/{\s*suffix\s*}/g,c)}const B=L({name:"uniDateformat",props:{date:{type:[Object,String,Number],default:()=>"-"},locale:{type:String,default:"zh"},threshold:{type:Array,default:()=>[0,0]},format:{type:String,default:"yyyy/MM/dd hh:mm:ss"},refreshRate:{type:[Number,String],default:0}},data:()=>({refreshMark:0}),computed:{dateShow(){return this.refreshMark,A(this.date,{locale:this.locale,threshold:this.threshold,format:this.format})}},watch:{refreshRate:{handler(){this.setAutoRefresh()},immediate:!0}},methods:{refresh(){this.refreshMark++},setAutoRefresh(){clearInterval(this.refreshInterval),this.refreshRate&&(this.refreshInterval=setInterval((()=>{this.refresh()}),parseInt(this.refreshRate)))}}},[["render",function(l,n,o,d,u,c){const f=i;return e(),t(f,null,{default:a((()=>[r(s(c.dateShow),1)])),_:1})}]]);const P=L({name:"UniCard",emits:["click"],props:{title:{type:String,default:""},subTitle:{type:String,default:""},padding:{type:String,default:"10px"},margin:{type:String,default:"15px"},spacing:{type:String,default:"0 10px"},extra:{type:String,default:""},cover:{type:String,default:""},thumbnail:{type:String,default:""},isFull:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!0},shadow:{type:String,default:"0px 0px 3px 1px rgba(0, 0, 0, 0.08)"},border:{type:Boolean,default:!0}},methods:{onClick(e){this.$emit("click",e)}}},[["render",function(h,m,p,y,_,g){const D=c,b=f,k=i;return e(),t(b,{class:u(["uni-card",{"uni-card--full":p.isFull,"uni-card--shadow":p.isShadow,"uni-card--border":p.border}]),style:d({margin:p.isFull?0:p.margin,padding:p.spacing,"box-shadow":p.isShadow?p.shadow:""})},{default:a((()=>[l(h.$slots,"cover",{},(()=>[p.cover?(e(),t(b,{key:0,class:"uni-card__cover"},{default:a((()=>[n(D,{class:"uni-card__cover-image",mode:"widthFix",onClick:m[0]||(m[0]=e=>g.onClick("cover")),src:p.cover},null,8,["src"])])),_:1})):o("",!0)]),!0),l(h.$slots,"title",{},(()=>[p.title||p.extra?(e(),t(b,{key:0,class:"uni-card__header"},{default:a((()=>[n(b,{class:"uni-card__header-box",onClick:m[1]||(m[1]=e=>g.onClick("title"))},{default:a((()=>[p.thumbnail?(e(),t(b,{key:0,class:"uni-card__header-avatar"},{default:a((()=>[n(D,{class:"uni-card__header-avatar-image",src:p.thumbnail,mode:"aspectFit"},null,8,["src"])])),_:1})):o("",!0),n(b,{class:"uni-card__header-content"},{default:a((()=>[n(k,{class:"uni-card__header-content-title uni-ellipsis"},{default:a((()=>[r(s(p.title),1)])),_:1}),p.title&&p.subTitle?(e(),t(k,{key:0,class:"uni-card__header-content-subtitle uni-ellipsis"},{default:a((()=>[r(s(p.subTitle),1)])),_:1})):o("",!0)])),_:1})])),_:1}),n(b,{class:"uni-card__header-extra",onClick:m[2]||(m[2]=e=>g.onClick("extra"))},{default:a((()=>[n(k,{class:"uni-card__header-extra-text"},{default:a((()=>[r(s(p.extra),1)])),_:1})])),_:1})])),_:1})):o("",!0)]),!0),n(b,{class:"uni-card__content",style:d({padding:p.padding}),onClick:m[3]||(m[3]=e=>g.onClick("content"))},{default:a((()=>[l(h.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),n(b,{class:"uni-card__actions",onClick:m[4]||(m[4]=e=>g.onClick("actions"))},{default:a((()=>[l(h.$slots,"actions",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}],["__scopeId","data-v-b4135a35"]]),U=L({__name:"trip-item",props:{orderData:{type:Object},detailData:{type:Object}},emits:["delete"],setup(l,{emit:o}){const d=h((()=>{switch(D.orderData.status){case"pending":return"待支付";case"paid":return"已支付";case"ing":return"进行中";case"completed":return"已完成";case"concelled":return"已取消"}})),u=h((()=>{const e=new Date(D.orderData.startDate),t=new Date,a=e-t,r=new Date(D.orderData.endDate)-t,s=Math.ceil(a/864e5);return a>0?`距离行程开始还有${s}天`:a<=0&&r>=0?"行程进行中":r<=0?"行程已结束":void 0})),g=o,D=l,b=async()=>"已支付"===d.value?y({title:"当前行程已支付，无法取消",icon:"error"}):"进行中"===d.value?y({title:"当前行程进行中，无法取消",icon:"error"}):void g("delete");return(o,h)=>{const y=c,g=j(m("uni-dateformat"),B),D=i,k=f,v=_,w=j(m("uni-card"),P);return e(),t(k,{class:"trip-item"},{default:a((()=>{var e,t;return[n(w,{title:null==(e=l.detailData)?void 0:e.location,"sub-title":null==(t=l.detailData)?void 0:t.description,extra:d.value,padding:"10px 0"},{default:a((()=>{var e;return[n(y,{style:{width:"100%"},src:null==(e=l.detailData)?void 0:e.imgUrl[0]},null,8,["src"]),n(k,{class:"time"},{default:a((()=>{var e,t;return[n(g,{date:null==(e=l.orderData)?void 0:e.startDate,format:"yyyy-MM-dd"},null,8,["date"]),n(D,null,{default:a((()=>[r("——")])),_:1}),n(g,{date:null==(t=l.orderData)?void 0:t.endDate,format:"yyyy-MM-dd"},null,8,["date"])]})),_:1}),n(k,{class:"last-day"},{default:a((()=>[r(s(u.value),1)])),_:1}),n(k,{class:"price"},{default:a((()=>{var e;return[r("共计："+s(p(F)(null==(e=l.orderData)?void 0:e.totalPrice,2,"￥")),1)]})),_:1}),n(k,{class:"cancel"},{default:a((()=>[n(v,{class:"cancel-btn",type:"default",onClick:b},{default:a((()=>[r("取消行程")])),_:1})])),_:1})]})),_:1},8,["title","sub-title","extra"])]})),_:1})}}},[["__scopeId","data-v-dc702e1f"]]),H=g("trip",{state:()=>({orderList:[],tripDataList:[]}),actions:{async fetchOrderList(){const e=await N.get("/order");this.orderList=e.data.res},async fetchTripDataList(){for(let e=0;e<this.orderList.length;e++){const t=await N.get(`/detail?id=${this.orderList[e].listId}`);this.tripDataList.push(t.data.listDeatil)}}}}),q=L({__name:"trip",setup(s){const i=H(),l=O();C((()=>{i.fetchOrderList(),i.fetchTripDataList(),setTimeout((()=>{D()}),1e3)})),I((async()=>{await i.fetchOrderList(),await i.fetchTripDataList()})),T((async()=>{const e=b("user_token");e||(y({title:"请登录后查看",icon:"error"}),k({url:"/subPackages/user/login/login"}));401===(await l.fetchUserData()).status&&e&&(y({title:"登录已过期，请重新登录",icon:"error"}),k({url:"/subPackages/user/login/login"}))}));const o=()=>{S({url:"/pages/search/search"})};return(s,l)=>{const d=j(m("uni-nav-bar"),x),u=f,c=_,h=j(m("trip-item"),U);return e(),t(u,{class:"trip"},{default:a((()=>[n(d,{shadow:"true",dark:"",fixed:!0,"background-color":"#c5b6a0","status-bar":"",title:"我的行程"}),p(i).orderList.length?(e(),t(u,{key:1,class:"trip-list"},{default:a((()=>[(e(!0),v(M,null,w(p(i).orderList,((r,s)=>(e(),t(u,{key:r.id,class:"trip-item"},{default:a((()=>[n(h,{onDelete:e=>(async e=>{await N.delete("/order",{},{orderNumber:i.orderList[e].orderNumber}),i.orderList.splice(e,1),y({title:"行程删除成功"})})(s),orderData:r,detailData:p(i).tripDataList[s]},null,8,["onDelete","orderData","detailData"])])),_:2},1024)))),128))])),_:1})):(e(),t(u,{key:0,class:"empty"},{default:a((()=>[n(u,{class:"title"},{default:a((()=>[r(" 尚未预定任何行程！ ")])),_:1}),n(u,{class:"content"},{default:a((()=>[r(" 是时候拿出你的行李箱，着手规划下一趟行程了。 ")])),_:1}),n(u,null,{default:a((()=>[n(c,{class:"btn",type:"default",onClick:o},{default:a((()=>[r("开始探索")])),_:1})])),_:1})])),_:1}))])),_:1})}}},[["__scopeId","data-v-c6546082"]]);export{q as default};
